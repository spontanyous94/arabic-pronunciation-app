<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="en"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta charset="UTF-8"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;title&gt;Arabic Reading Practice - Page 1&lt;/title&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>body { font-family: sans-serif; margin: 20px; text-align: center; background-color: #f4f4f4; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>h1 { color: #333; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>input, button { padding: 10px 15px; margin: 5px; border-radius: 5px; border: 1px solid #ccc; font-size: 16px; cursor: pointer; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>input[type="text"] { width: 250px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>button { background-color: #007bff; color: white; border: none; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>button:disabled { background-color: #cccccc; cursor: not-allowed; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#pageImage { max-width: 90%; height: auto; margin-top: 20px; border: 1px solid #ddd; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>#statusMessage { margin-top: 20px; font-weight: bold; color: #333; min-height: 20px; }</p>
<p class="p1"><span class="Apple-converted-space">        </span>.instructions { margin-top: 15px; padding: 10px; background-color: #e9ecef; border-radius: 5px; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;h1&gt;Reading Practice – Page 1&lt;/h1&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="instructions"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;Hello! Please type your name, then press "Start recording" and read the page aloud.&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;p&gt;When you finish, press "Stop recording", then "Send to teacher".&lt;/p&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;input type="text" id="studentNameInput" placeholder="Type your name here" required&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;!-- TODO: Change this image filename to your actual image file (e.g., "page1.jpg") --&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;img id="pageImage" src="page1.jpg" alt="Book Page 1"&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="startButton"&gt;Start recording&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="stopButton" disabled&gt;Stop recording&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;button id="sendButton" disabled&gt;Send to teacher&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div id="statusMessage"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;script type="module"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>// TODO: REPLACE THIS ENTIRE CONFIG OBJECT WITH YOUR ACTUAL FIREBASE CONFIG SNIPPET</p>
<p class="p1"><span class="Apple-converted-space">        </span>// You found this when you registered your web app in the Firebase Console.</p>
<p class="p1"><span class="Apple-converted-space">        </span>// It looks like: const firebaseConfig = { ... };</p>
<p class="p1"><span class="Apple-converted-space">        </span>const firebaseConfig = {</p>
<p class="p1"><span class="Apple-converted-space">            </span>apiKey: "YOUR_API_KEY",</p>
<p class="p1"><span class="Apple-converted-space">            </span>authDomain: "YOUR_PROJECT_ID.firebaseapp.com",</p>
<p class="p1"><span class="Apple-converted-space">            </span>projectId: "YOUR_PROJECT_ID",</p>
<p class="p1"><span class="Apple-converted-space">            </span>storageBucket: "YOUR_PROJECT_ID.appspot.com",</p>
<p class="p1"><span class="Apple-converted-space">            </span>messagingSenderId: "YOUR_MESSAGING_SENDER_ID",</p>
<p class="p1"><span class="Apple-converted-space">            </span>appId: "YOUR_APP_ID"</p>
<p class="p1"><span class="Apple-converted-space">        </span>};</p>
<p class="p1"><span class="Apple-converted-space">        </span>// END OF FIREBASE CONFIG BLOCK</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// TODO: Change this constant for each different page/task (e.g., "page1", "unit3_lesson1")</p>
<p class="p1"><span class="Apple-converted-space">        </span>const PAGE_ID = "page1";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Import Firebase services (Web v10 modular SDK)</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getStorage, ref, uploadBytes } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-storage.js";</p>
<p class="p1"><span class="Apple-converted-space">        </span>import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Initialize Firebase</p>
<p class="p1"><span class="Apple-converted-space">        </span>const app = initializeApp(firebaseConfig);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const auth = getAuth(app);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const storage = getStorage(app);</p>
<p class="p1"><span class="Apple-converted-space">        </span>const db = getFirestore(app);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// UI elements</p>
<p class="p1"><span class="Apple-converted-space">        </span>const studentNameInput = document.getElementById('studentNameInput');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const startButton = document.getElementById('startButton');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const stopButton = document.getElementById('stopButton');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const sendButton = document.getElementById('sendButton');</p>
<p class="p1"><span class="Apple-converted-space">        </span>const statusMessage = document.getElementById('statusMessage');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>let mediaRecorder;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let audioChunks = [];</p>
<p class="p1"><span class="Apple-converted-space">        </span>let audioBlob;</p>
<p class="p1"><span class="Apple-converted-space">        </span>let currentUser; // To store the anonymous user after sign-in</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- Event Listeners ---</p>
<p class="p1"><span class="Apple-converted-space">        </span>startButton.addEventListener('click', startRecording);</p>
<p class="p1"><span class="Apple-converted-space">        </span>stopButton.addEventListener('click', stopRecording);</p>
<p class="p1"><span class="Apple-converted-space">        </span>sendButton.addEventListener('click', sendToTeacher);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// --- Functions ---</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Function to update the UI (buttons and status message)</p>
<p class="p1"><span class="Apple-converted-space">        </span>function updateUI(state) {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (state === 'initial') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>startButton.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>studentNameInput.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = '';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (state === 'recording') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>startButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopButton.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>studentNameInput.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = 'Recording...';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (state === 'recorded') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>startButton.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendButton.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>studentNameInput.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = 'Recording finished. Ready to send.';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (state === 'sending') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>startButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>studentNameInput.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = 'Sending to teacher...';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (state === 'sent') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>startButton.disabled = true; // Disable start after sending</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>studentNameInput.disabled = true; // Keep disabled for this session</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = '✅ Your recording has been sent to your teacher!';</p>
<p class="p1"><span class="Apple-converted-space">            </span>} else if (state === 'error') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>startButton.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>stopButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>sendButton.disabled = true;</p>
<p class="p1"><span class="Apple-converted-space">                </span>studentNameInput.disabled = false;</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = 'Error! Please try again.';</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Initialize UI on page load</p>
<p class="p1"><span class="Apple-converted-space">        </span>updateUI('initial');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Start recording audio</p>
<p class="p1"><span class="Apple-converted-space">        </span>async function startRecording() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!studentNameInput.value.trim()) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert("Please type your name before starting to record.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>const stream = await navigator.mediaDevices.getUserMedia({ audio: true });</p>
<p class="p1"><span class="Apple-converted-space">                </span>mediaRecorder = new MediaRecorder(stream);</p>
<p class="p1"><span class="Apple-converted-space">                </span>audioChunks = []; // Clear previous recordings</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>mediaRecorder.ondataavailable = event =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>audioChunks.push(event.data);</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>mediaRecorder.onstop = () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>audioBlob = new Blob(audioChunks, { type: 'audio/webm' });</p>
<p class="p1"><span class="Apple-converted-space">                    </span>updateUI('recorded');</p>
<p class="p1"><span class="Apple-converted-space">                    </span>stream.getTracks().forEach(track =&gt; track.stop()); // Stop microphone access</p>
<p class="p1"><span class="Apple-converted-space">                </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>mediaRecorder.start();</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateUI('recording');</p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (err) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Error accessing microphone:", err);</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = "Error: Could not access your microphone. Please allow access.";</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateUI('error');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Stop recording audio</p>
<p class="p1"><span class="Apple-converted-space">        </span>function stopRecording() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (mediaRecorder &amp;&amp; mediaRecorder.state === 'recording') {</p>
<p class="p1"><span class="Apple-converted-space">                </span>mediaRecorder.stop();</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>// Send recording to Firebase</p>
<p class="p1"><span class="Apple-converted-space">        </span>async function sendToTeacher() {</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!audioBlob) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = "No recording found. Please record first.";</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">            </span>if (!studentNameInput.value.trim()) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>alert("Your name is missing! Please type it in.");</p>
<p class="p1"><span class="Apple-converted-space">                </span>return;</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>updateUI('sending');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>try {</p>
<p class="p1"><span class="Apple-converted-space">                </span>// 1. Sign in anonymously if not already signed in</p>
<p class="p1"><span class="Apple-converted-space">                </span>if (!currentUser) {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>const userCredential = await signInAnonymously(auth);</p>
<p class="p1"><span class="Apple-converted-space">                    </span>currentUser = userCredential.user;</p>
<p class="p1"><span class="Apple-converted-space">                    </span>console.log("Signed in anonymously:", currentUser.uid);</p>
<p class="p1"><span class="Apple-converted-space">                </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 2. Upload to Firebase Storage</p>
<p class="p1"><span class="Apple-converted-space">                </span>const studentName = studentNameInput.value.trim();</p>
<p class="p1"><span class="Apple-converted-space">                </span>const timestamp = new Date().toISOString().replace(/[:.]/g, '-'); // Simple timestamp for filename</p>
<p class="p1"><span class="Apple-converted-space">                </span>const storageFileName = `${studentName}-${timestamp}.webm`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const storagePath = `recordings/${PAGE_ID}/${storageFileName}`;</p>
<p class="p1"><span class="Apple-converted-space">                </span>const storageRef = ref(storage, storagePath);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>await uploadBytes(storageRef, audioBlob);</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log("Audio uploaded to Storage:", storagePath);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>// 3. Write metadata to Cloud Firestore</p>
<p class="p1"><span class="Apple-converted-space">                </span>await addDoc(collection(db, "recordings"), {</p>
<p class="p1"><span class="Apple-converted-space">                    </span>studentName: studentName,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>pageId: PAGE_ID,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>storagePath: storagePath,</p>
<p class="p1"><span class="Apple-converted-space">                    </span>createdAt: serverTimestamp() // Firebase timestamp for when it was added</p>
<p class="p1"><span class="Apple-converted-space">                </span>});</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.log("Recording metadata saved to Firestore.");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">                </span>updateUI('sent');</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">            </span>} catch (error) {</p>
<p class="p1"><span class="Apple-converted-space">                </span>console.error("Error sending recording:", error);</p>
<p class="p1"><span class="Apple-converted-space">                </span>statusMessage.textContent = "Failed to send recording. Please try again.";</p>
<p class="p1"><span class="Apple-converted-space">                </span>updateUI('error');</p>
<p class="p1"><span class="Apple-converted-space">            </span>}</p>
<p class="p1"><span class="Apple-converted-space">        </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
